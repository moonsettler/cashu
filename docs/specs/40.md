# NUT-40: Notation and Models

Sending user: `Alice`
Receiving user: `Carol`
Mint: `Bob`

## Bob (mint)

- `m` id of the mint (hash of the mint's descriptor)
- `k` private key of mint (one for each amount)
- `K` public key of mint (`K = kG`)
- `Q` promise (blinded signature)

## Alice (user)

- `r` private key (blinding factor)
- `x` secret derived from `r` via one way function, corresponds to point `Y` on curve
- `T` blinded message
- `Z` proof (unblinded signature)

# Blind Diffie-Hellmann key exchange (BDHKE)

- `Bob` (also known as mint `m`) publishes `K = kG`
- `Alice` picks private key `r`
- `Alice` computes `x = hmac(m, r)` and computes `Y = hash_to_curve(x)`
- `Alice` sends to `Bob`: `T = Y + rG` with `r` (**blinding**)
- `Bob` sends back to `Alice` blinded key: `Q = kT` (these two steps are the DH key exchange) (**signing**)
- `Alice` can calculate the unblinded key as `Q - rK = kY + krG - krG = kY = Z` (**unblinding**)
- Alice can take the pair `(x, Z)` as a token and can send it to `Carol`.
- `Carol` can send `(x, Z)` to `Bob` who then checks that `k*hash_to_curve(x) == Z` (**verification**), and if so treats it as a valid spend of a token, adding `x`  to the list of spent secrets.

# Chaum-Pedersen Commitment (DLEQ)

## Bob (mint) creates DLEQ proof
- `p` random nonce
- `R1 = P = pG`
- `R2 = pT` where `T` is the blinded message `Y + rG`
- `e = hash(R1, R2, K, Q)`
- `s = p + ek`

`Bob` reveales to `Alice` the following vector: `(Q, e, s)`

## Alice (user) verifies DLEQ proof
- `R1 = eK - sG`
- `R2 = eQ - sT`

`Alice` then checks `e == hash(R1, R2, K, Q)` to ensure `Bob` signed with private key `k` preventing secret tagging or deniability on `Q`.

`Alice` reveales to `Carol` the following vector: `(m, r, Q, e, s)`

## Carol (user) computes blind signature and verifies DLEQ proof
- `x = hmac(m, r)`
- `Z = Q - rK`
- `T = hash_to_curve(x) + rG`
- `R1 = eK - sG`
- `R2 = eQ - sT`
- `e == hash(R1, R2, K, Q)` (**verification**)

`Carol` reveales to `Bob` the following vector: `(x, Z)` where `k*hash_to_curve(x) == Z`

`Bob` is unable to link `T` (or `Q`)  to `x` and `Z` without knowing `r` which is only known to `Alice` and `Carol`.
